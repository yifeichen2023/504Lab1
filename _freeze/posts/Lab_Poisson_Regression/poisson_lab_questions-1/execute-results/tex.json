{
  "hash": "2e8438e8dfc55263f05a379d41462534",
  "result": {
    "engine": "knitr",
    "markdown": "---\n    title: \"Lab 5 - Poisson - Questions\"\n    author:\n      - name: Yifei Chen\n    date: last-modified\n    format:\n      html:\n        self-contained: true\n        anchor-sections: true\n        code-tools: true\n        code-fold: true\n        fig-width: 8\n        fig-height: 4\n        code-block-bg: \"#f1f3f5\"\n        code-block-border-left: \"#31BAE9\"\n        mainfont: Source Sans Pro\n        theme: journal\n        toc: true\n        toc-depth: 3\n        toc-location: left\n        captions: true\n        cap-location: margin\n        table-captions: true\n        tbl-cap-location: margin\n        reference-location: margin\n      pdf:\n        pdf-engine: lualatex\n        toc: false\n        number-sections: true\n        number-depth: 2\n        top-level-division: section\n        reference-location: document\n        listings: false\n        header-includes:\n          \\usepackage{marginnote, here, relsize, needspace, setspace}\n          \\def\\it{\\emph}\n\n    comments:\n      hypothesis: false\n\n    execute:\n      warning: false\n      message: false\n---\n\n\n\n\n\n\n\n\n\n\n1.  To complete this lab:\n\n-   Load packages\n\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(MASS)\nlibrary(tidyverse)\nlibrary(emmeans)\nlibrary(ggeffects)\nlibrary(easystats)\nlibrary(performance)\nlibrary(knitr)\n```\n:::\n\n\n\n\n\n\n\n\n\n\n- Download the dataset:\n\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n\ndata <- read_delim(\"https://raw.githubusercontent.com/jgeller112/psy504-advanced-stats/main/slides/Poisson/data/2010.csv\")\n```\n:::\n\n\n\n\n\n\n\n\n\n\n2. Conduct the analysis described in the preregistration document\n\na.  The number of hours per week that a person spends on the Internet (\"WWWHR\") will\\\n    be predicted by their vocabulary (\"WORDSUM\"), age (\"AGE\"), sex (\"SEX\"), religiosity\\\n    (\"RELITEN\"), political orientation (\"POLVIEWS\"), and how often they work from home\\\n    (\"WRKHOME\").\n\n\n- Let's use the `naniar` package's function `replace_with_na`to clean the data. \n\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(naniar)\n\ndata_pos <- data %>%\n  dplyr::select(wwwhr, wordsum, age, sex, reliten, polviews, wrkhome) %>%\nreplace_with_na(.,\n             replace = list(wwwhr = c(-1, 998, 999),\n                          wordsum = c(-1, 99),\n                          reliten = c(0, 8, 9), \n             polviews = c(0, 8, 9), \n             wrkhome = c(0,8,9), \n             age=c(0, 98, 99)))\n```\n:::\n\n\n\n\n\n\n\n\n\nQ: Can you explain what might be going on in the above code?\n\nA: It is replacing certain values within the specified column with NA to indicate missing/invalid data. It also first filter out columns that we don't need for further analysis.\n\n\n\nQ: The next step in data cleaning would be to ensure that the data in your code are aligned with the description/ usage context of the variables\n\n- Recode sex and reliten as necessary\n\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_pos <- data_pos %>%\n  mutate(sex = factor(sex, levels = c(-1, 1)),\n         reliten = factor(reliten, levels = c(1, 2, 3, 4)))\n```\n:::\n\n\n\n\n\n\n\n\n\n## Missingness\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(skimr)\nskimr::skim(data_pos)\n```\n\n::: {.cell-output-display}\n\nTable: Data summary\n\n|                         |         |\n|:------------------------|:--------|\n|Name                     |data_pos |\n|Number of rows           |2044     |\n|Number of columns        |7        |\n|_______________________  |         |\n|Column type frequency:   |         |\n|factor                   |2        |\n|numeric                  |5        |\n|________________________ |         |\n|Group variables          |None     |\n\n\n**Variable type: factor**\n\n|skim_variable | n_missing| complete_rate|ordered | n_unique|top_counts                     |\n|:-------------|---------:|-------------:|:-------|--------:|:------------------------------|\n|sex           |         0|          1.00|FALSE   |        2|-1: 1153, 1: 891               |\n|reliten       |        99|          0.95|FALSE   |        4|2: 747, 1: 707, 4: 363, 3: 128 |\n\n\n**Variable type: numeric**\n\n|skim_variable | n_missing| complete_rate|  mean|    sd| p0| p25| p50| p75| p100|hist  |\n|:-------------|---------:|-------------:|-----:|-----:|--:|---:|---:|---:|----:|:-----|\n|wwwhr         |       996|          0.51|  9.79| 13.41|  0|   2|   5|  14|  168|▇▁▁▁▁ |\n|wordsum       |       657|          0.68|  6.03|  2.07|  0|   5|   6|   7|   10|▁▃▇▅▂ |\n|age           |         3|          1.00| 47.97| 17.68| 18|  33|  47|  61|   89|▇▇▇▅▃ |\n|polviews      |        71|          0.97|  4.08|  1.46|  1|   3|   4|   5|    7|▃▂▇▃▅ |\n|wrkhome       |       882|          0.57|  2.26|  1.72|  1|   1|   1|   4|    6|▇▁▁▂▁ |\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\n\n\n## Fit a Poisson model to the data.\n\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel <- glm(wwwhr ~ wordsum + age + sex + reliten + polviews + wrkhome, \n                     data = data_pos, family = poisson(link = \"log\"))\n\nsummary(model)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = wwwhr ~ wordsum + age + sex + reliten + polviews + \n    wrkhome, family = poisson(link = \"log\"), data = data_pos)\n\nCoefficients:\n             Estimate Std. Error z value Pr(>|z|)    \n(Intercept)  1.754427   0.080100  21.903  < 2e-16 ***\nwordsum      0.101883   0.007805  13.053  < 2e-16 ***\nage         -0.016611   0.001087 -15.280  < 2e-16 ***\nsex1         0.250233   0.026567   9.419  < 2e-16 ***\nreliten2     0.343367   0.037223   9.225  < 2e-16 ***\nreliten3     0.409478   0.063447   6.454 1.09e-10 ***\nreliten4     0.659817   0.039307  16.786  < 2e-16 ***\npolviews    -0.032646   0.009768  -3.342 0.000831 ***\nwrkhome      0.078655   0.007661  10.267  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 7666.1  on 602  degrees of freedom\nResidual deviance: 6463.6  on 594  degrees of freedom\n  (1441 observations deleted due to missingness)\nAIC: 8525.9\n\nNumber of Fisher Scoring iterations: 5\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\n## Carry out model checking\n\nHint: performance package has the function you're looking for\n\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nperformance::check_overdispersion(model)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# Overdispersion test\n\n       dispersion ratio =   14.654\n  Pearson's Chi-Squared = 8704.487\n                p-value =  < 0.001\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\n\n## Find any outliers\n\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\noutliers <- performance::check_outliers(model)\ndata_pos_clean <- data_pos[-outliers, ]\n```\n:::\n\n\n\n\n\n\n\n\n\n\n## Refit the model after excludint outliers\n\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel2 <- glm(wwwhr ~ wordsum + age + sex + reliten + polviews + wrkhome, \n                           data = data_pos_clean, family = poisson(link = \"log\"))\n\nsummary(model2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = wwwhr ~ wordsum + age + sex + reliten + polviews + \n    wrkhome, family = poisson(link = \"log\"), data = data_pos_clean)\n\nCoefficients:\n             Estimate Std. Error z value Pr(>|z|)    \n(Intercept)  1.767293   0.080239  22.025  < 2e-16 ***\nwordsum      0.101780   0.007801  13.047  < 2e-16 ***\nage         -0.016693   0.001087 -15.353  < 2e-16 ***\nsex1         0.252977   0.026584   9.516  < 2e-16 ***\nreliten2     0.336660   0.037290   9.028  < 2e-16 ***\nreliten3     0.403315   0.063473   6.354  2.1e-10 ***\nreliten4     0.652067   0.039412  16.545  < 2e-16 ***\npolviews    -0.033709   0.009774  -3.449 0.000563 ***\nwrkhome      0.078938   0.007657  10.309  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 7659.5  on 601  degrees of freedom\nResidual deviance: 6457.6  on 593  degrees of freedom\n  (1441 observations deleted due to missingness)\nAIC: 8516.9\n\nNumber of Fisher Scoring iterations: 5\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel_parameters(model2) %>%\n  print_html()\n```\n\n::: {.cell-output-display}\n\\begin{table}\n\\fontsize{12.0pt}{14.4pt}\\selectfont\n\\begin{tabular*}{\\linewidth}{@{\\extracolsep{\\fill}}lccccc}\n\\toprule\nParameter & Coefficient & SE & 95\\% CI & z & p \\\\ \n\\midrule\\addlinespace[2.5pt]\n{(Intercept)} & 1.77 & 0.08 & (1.61, 1.92) & 22.03 & < .001 \\\\ \n{wordsum} & 0.10 & 7.80e-03 & (0.09, 0.12) & 13.05 & < .001 \\\\ \n{age} & -0.02 & 1.09e-03 & (-0.02, -0.01) & -15.35 & < .001 \\\\ \n{sex (1)} & 0.25 & 0.03 & (0.20, 0.31) & 9.52 & < .001 \\\\ \n{reliten (2)} & 0.34 & 0.04 & (0.26, 0.41) & 9.03 & < .001 \\\\ \n{reliten (3)} & 0.40 & 0.06 & (0.28, 0.53) & 6.35 & < .001 \\\\ \n{reliten (4)} & 0.65 & 0.04 & (0.58, 0.73) & 16.55 & < .001 \\\\ \n{polviews} & -0.03 & 9.77e-03 & (-0.05, -0.01) & -3.45 & < .001 \\\\ \n{wrkhome} & 0.08 & 7.66e-03 & (0.06, 0.09) & 10.31 & < .001 \\\\ \n\\bottomrule\n\\end{tabular*}\n\\begin{minipage}{\\linewidth}\n\\\\\n\\end{minipage}\n\\end{table}\n\n:::\n:::\n\n\n\n\n\n\n\n\n\n\n### Check for Overdispersion \n\nHint: performance package has the function you're looking for\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nperformance::check_overdispersion(model2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# Overdispersion test\n\n       dispersion ratio =   14.654\n  Pearson's Chi-Squared = 8689.701\n                p-value =  < 0.001\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\n\nWhat do you notice?\nAnd what's a good next step forward?\nCan there be another model class that can fit the data? If so, fit this model to the data. \n\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# it is still not a good fit after excluding the outliers, next step -> negative binomial\nnb_model <- glm.nb(wwwhr ~ wordsum + age + sex + reliten + polviews + wrkhome, \n                   data = data_pos_clean)\n\nsummary(nb_model)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm.nb(formula = wwwhr ~ wordsum + age + sex + reliten + polviews + \n    wrkhome, data = data_pos_clean, init.theta = 0.9663571073, \n    link = log)\n\nCoefficients:\n             Estimate Std. Error z value Pr(>|z|)    \n(Intercept)  1.824523   0.258989   7.045 1.86e-12 ***\nwordsum      0.107128   0.025981   4.123 3.73e-05 ***\nage         -0.016239   0.003528  -4.603 4.16e-06 ***\nsex1         0.163860   0.089710   1.827  0.06777 .  \nreliten2     0.310860   0.109539   2.838  0.00454 ** \nreliten3     0.360300   0.207253   1.738  0.08213 .  \nreliten4     0.638718   0.128299   4.978 6.41e-07 ***\npolviews    -0.033156   0.033246  -0.997  0.31863    \nwrkhome      0.056940   0.026989   2.110  0.03488 *  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for Negative Binomial(0.9664) family taken to be 1)\n\n    Null deviance: 770.55  on 601  degrees of freedom\nResidual deviance: 670.42  on 593  degrees of freedom\n  (1441 observations deleted due to missingness)\nAIC: 3938.6\n\nNumber of Fisher Scoring iterations: 1\n\n              Theta:  0.9664 \n          Std. Err.:  0.0597 \n\n 2 x log-likelihood:  -3918.5570 \n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\n\n## Which one is better- your earlier model, or later model?\nnegative binomial is significantly better\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntest_likelihoodratio(model2, nb_model) %>%\n  kable()\n```\n\n::: {.cell-output-display}\n\n\n|         |Name     |Model  | df| df_diff|     Chi2|  p|\n|:--------|:--------|:------|--:|-------:|--------:|--:|\n|model2   |model2   |glm    |  9|      NA|       NA| NA|\n|nb_model |nb_model |negbin | 10|       1| 4580.367|  0|\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\n\n## What is zero inflation? Is there zero-inflation in your chosen model?\nzero inflation -> too many zeros can bias results. Yes, there is zero-inflation in the model. Observed zeros < predicted\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nperformance::check_zeroinflation(nb_model)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# Check for zero-inflation\n\n   Observed zeros: 40\n  Predicted zeros: 67\n            Ratio: 1.68\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(pscl)\nzif_model <- zeroinfl(wwwhr ~ wordsum + age + sex + reliten + polviews + wrkhome | 1, \n                       data = data_pos_clean, dist = \"negbin\")\n\nsummary(zif_model)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nzeroinfl(formula = wwwhr ~ wordsum + age + sex + reliten + polviews + \n    wrkhome | 1, data = data_pos_clean, dist = \"negbin\")\n\nPearson residuals:\n    Min      1Q  Median      3Q     Max \n-0.9568 -0.7130 -0.3937  0.2668  7.6559 \n\nCount model coefficients (negbin with log link):\n             Estimate Std. Error z value Pr(>|z|)    \n(Intercept)  1.824512   0.263285   6.930 4.21e-12 ***\nwordsum      0.107133   0.027367   3.915 9.05e-05 ***\nage         -0.016239   0.003633  -4.470 7.84e-06 ***\nsex1         0.163843   0.090917   1.802  0.07153 .  \nreliten2     0.310846   0.109528   2.838  0.00454 ** \nreliten3     0.360270   0.207851   1.733  0.08304 .  \nreliten4     0.638695   0.127404   5.013 5.35e-07 ***\npolviews    -0.033156   0.032774  -1.012  0.31170    \nwrkhome      0.056942   0.027562   2.066  0.03883 *  \nLog(theta)  -0.034211   0.061746  -0.554  0.57954    \n\nZero-inflation model coefficients (binomial with logit link):\n            Estimate Std. Error z value Pr(>|z|)\n(Intercept)    -12.2       26.9  -0.454     0.65\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 \n\nTheta = 0.9664 \nNumber of iterations in BFGS optimization: 24 \nLog-likelihood: -1959 on 11 Df\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\n\n::: panel-tabset\n## Log Lambda\n\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlog_lambda <- predict(model2, type = \"link\")  # Get predicted log(lambda)\nlog_lambda_df <- data.frame(Log_Lambda = log_lambda)\n\nhead(log_lambda_df)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Log_Lambda\n1    3.199785\n10   2.208683\n19   2.361181\n20   2.060068\n24   2.739818\n27   3.064426\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\n\n## Mean Count\n\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmean_count <- predict(model2, type = \"response\")  # Get predicted mean counts\nmean_count_df <- data.frame(Mean_Count = mean_count)\nhead(mean_count_df)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Mean_Count\n1   24.527263\n10   9.103718\n19  10.603469\n20   7.846504\n24  15.484166\n27  21.422162\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\n:::\n\n## Report your conclusions\nThe negative binomial regression model is the best fit for this data set since it handles overdispersion better than the Poisson one. The model essentially shows us that people with higher vocab scores and those who work from home more often are associated with spending more time on the Internet. Older folks with stronger religiosity spend less time on the Internet. Both sex and political orientation show no significant effect. However, the negative binomial model still has zero inflation issue, so the zero-inflated negative binomial model may be the best one.",
    "supporting": [
      "poisson_lab_questions-1_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "\\usepackage{booktabs}\n\\usepackage{caption}\n\\usepackage{longtable}\n\\usepackage{colortbl}\n\\usepackage{array}\n\\usepackage{anyfontsize}\n\\usepackage{multirow}\n"
      ]
    },
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}