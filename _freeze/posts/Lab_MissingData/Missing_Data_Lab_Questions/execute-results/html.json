{
  "hash": "d79bb0203444cff69497cfbe181d0710",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Missing_Data_Lab\"\nformat: html\neditor: visual\n---\n\n\n\nMissing data is a common problem and dealing with it appropriately is extremely important. Ignoring the missing data points or filling them incorrectly may cause the models to work in unexpected ways and cause the predictions and inferences to be biased.\n\nLe'ts consider built-in dataset 'airquality' in R as a sample dataset.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load the airquality dataset\nlibrary(skimr)\n\ndata(\"airquality\")\nskim(airquality)\n```\n\n::: {.cell-output-display}\n\nTable: Data summary\n\n|                         |           |\n|:------------------------|:----------|\n|Name                     |airquality |\n|Number of rows           |153        |\n|Number of columns        |6          |\n|_______________________  |           |\n|Column type frequency:   |           |\n|numeric                  |6          |\n|________________________ |           |\n|Group variables          |None       |\n\n\n**Variable type: numeric**\n\n|skim_variable | n_missing| complete_rate|   mean|    sd|   p0|    p25|   p50|    p75|  p100|hist  |\n|:-------------|---------:|-------------:|------:|-----:|----:|------:|-----:|------:|-----:|:-----|\n|Ozone         |        37|          0.76|  42.13| 32.99|  1.0|  18.00|  31.5|  63.25| 168.0|▇▃▂▁▁ |\n|Solar.R       |         7|          0.95| 185.93| 90.06|  7.0| 115.75| 205.0| 258.75| 334.0|▅▃▅▇▅ |\n|Wind          |         0|          1.00|   9.96|  3.52|  1.7|   7.40|   9.7|  11.50|  20.7|▂▇▇▃▁ |\n|Temp          |         0|          1.00|  77.88|  9.47| 56.0|  72.00|  79.0|  85.00|  97.0|▂▃▇▇▃ |\n|Month         |         0|          1.00|   6.99|  1.42|  5.0|   6.00|   7.0|   8.00|   9.0|▇▇▇▇▇ |\n|Day           |         0|          1.00|  15.80|  8.86|  1.0|   8.00|  16.0|  23.00|  31.0|▇▇▇▇▆ |\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(naniar)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'naniar'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following object is masked from 'package:skimr':\n\n    n_complete\n```\n\n\n:::\n\n```{.r .cell-code}\nvis_miss(airquality)\n```\n\n::: {.cell-output-display}\n![](Missing_Data_Lab_Questions_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(naniar)\n\nmcar_test(airquality)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 4\n  statistic    df p.value missing.patterns\n      <dbl> <dbl>   <dbl>            <int>\n1      35.1    14 0.00142                4\n```\n\n\n:::\n:::\n\n\n\n#### Question 1:\n\n(a) Examine this dataset for missing values. While there are many ways to do this, the skim function from the library 'skimr' is elegant;\n\n    (a) 17 missing from Ozone and 7 missing from Solar.R\n\n(b) use the nanair package to visualize missing values\n\n    (a) DONE\n\n(c) even though it's hard to confirm based on visualizations alone, what do your visualizations lead you to believe about the missing data being MCAR, MAR, or MNAR?\n\n    (a) Ozone may be missing MCAR since it is really spread out, not so sure about Solar.R.\n\n(d) Carry out Little's statistical test to evaluate MCAR and report results.\n\n    (a) result suggests it is not MCAR\n\n(e) Creating a binary indicator for missingness allows you to test whether the presence of missing data is related to observed data.\n\n    -   For instance, you can create a dummy variable: 1 = Missing; 0 = Observed.\n    -   Next you can conduct a chi-square test or t-test:\n        -   Chi-square: Compare proportions of missingness ***across groups***.\n        -   T-test: Compare means of (other) observed variables with missingness indicators.\n    -   it looks like the values are more likely to be missing in certain period of time but not certain temperature.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a binary indicator for Ozone missingness\nairquality$Ozone_miss <- ifelse(is.na(airquality$Ozone), 1, 0)\n\n# Create a binary indicator for Solar.R missingness\nairquality$Solar_miss <- ifelse(is.na(airquality$Solar.R), 1, 0)\n\n# T-test to compare mean temperature between records with and without missing Ozone\nt_test_result <- t.test(Temp ~ Ozone_miss, data = airquality)\nprint(t_test_result)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tWelch Two Sample t-test\n\ndata:  Temp by Ozone_miss\nt = -0.026831, df = 60.447, p-value = 0.9787\nalternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0\n95 percent confidence interval:\n -3.643306  3.546847\nsample estimates:\nmean in group 0 mean in group 1 \n       77.87069        77.91892 \n```\n\n\n:::\n\n```{.r .cell-code}\nt_test_result <- t.test(Temp ~ Solar_miss, data = airquality)\nprint(t_test_result)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tWelch Two Sample t-test\n\ndata:  Temp by Solar_miss\nt = 0.98706, df = 6.2689, p-value = 0.3602\nalternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0\n95 percent confidence interval:\n -7.436381 17.669258\nsample estimates:\nmean in group 0 mean in group 1 \n       78.11644        73.00000 \n```\n\n\n:::\n\n```{.r .cell-code}\n# Chi-square test to check if Ozone missingness is related to Month\ntable_month_miss <- table(airquality$Month, airquality$Ozone_miss)\nchi_test_result <- chisq.test(table_month_miss)\nprint(chi_test_result)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tPearson's Chi-squared test\n\ndata:  table_month_miss\nX-squared = 44.751, df = 4, p-value = 4.48e-09\n```\n\n\n:::\n\n```{.r .cell-code}\ntable_month_miss <- table(airquality$Month, airquality$Solar_miss)\nchi_test_result <- chisq.test(table_month_miss)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in chisq.test(table_month_miss): Chi-squared approximation may be\nincorrect\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(chi_test_result)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tPearson's Chi-squared test\n\ndata:  table_month_miss\nX-squared = 11.136, df = 4, p-value = 0.02507\n```\n\n\n:::\n:::\n\n\n\n#### Question 2:\n\nCreate **new and appropriately named datasets** that are based on airquality for each of the following ways of fixing the dataset:\n\n```         \n  - (a) \"listwise deletion\" or \"complete case analysis\" --- where entire records from the analysis are removed if they are missing any data point in one or more variables \n  \n  - (b) Imputation with mean --- involves filling in the missing values with the mean of the available values in the same variable.\n  \n  - (c) Imputation with regression (use mice package)\n  \n  - (d) Imputation with stochastic regression (use mice package)\n\n  - (e) Imputation with multiple induction (use mice package, 5 imputations, and Predictive mean matching method)\n```\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# (a) Listwise deletion\nairquality_listwise <- na.omit(airquality)\n\n# (b) Mean imputation\nairquality_mean <- airquality\nairquality_mean$Ozone[is.na(airquality_mean$Ozone)] <- mean(airquality$Ozone, na.rm = TRUE)\nairquality_mean$Solar.R[is.na(airquality_mean$Solar.R)] <- mean(airquality$Solar.R, na.rm = TRUE)\n\n# Load mice package\nlibrary(mice)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'mice'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following object is masked from 'package:stats':\n\n    filter\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:base':\n\n    cbind, rbind\n```\n\n\n:::\n\n```{.r .cell-code}\n# (c) Regression imputation\n# Need to properly use complete() to get the imputed dataset\nimp_reg <- mice(airquality, method = \"norm.predict\", m = 1, maxit = 5, printFlag = FALSE)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Number of logged events: 10\n```\n\n\n:::\n\n```{.r .cell-code}\nairquality_regression <- complete(imp_reg)\n\n# (d) Stochastic regression imputation\n# Need to properly use complete() to get the imputed dataset\nimp_stoch <- mice(airquality, method = \"norm.nob\", m = 1, maxit = 5, printFlag = FALSE)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Number of logged events: 10\n```\n\n\n:::\n\n```{.r .cell-code}\nairquality_stoch_regression <- complete(imp_stoch)\n\n# (e) Multiple imputation with PMM\n# For multiple imputation, we need to specify the method for all variables\nimp_multi <- mice(airquality, method = \"pmm\", m = 5, maxit = 5, printFlag = FALSE)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Number of logged events: 50\n```\n\n\n:::\n\n```{.r .cell-code}\n# For comparison purposes, we'll extract the first imputed dataset\nairquality_multiple <- complete(imp_multi, 1)\n```\n:::\n\n\n\n#### Question 3:\n\nCompare the eventual distribution from these datasets on the variable 'Ozone'against the orgiinal. Below is a template that considers only 2 datasets but please consider all the datasets you generated within a single plot\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# ggplot(airquality, aes(x=Ozone, fill=\"Original\")) +\n#   geom_density(alpha=0.5) +\n#   geom_density(data=dataset_listwise_deletion, aes(x=Ozone, fill=\"Listwise Deletion\"), alpha=0.5) +\n#   labs(title=\"Density Plot of Ozone: Original vs. Imputed\")\n\n# Load ggplot2\nlibrary(ggplot2)\nlibrary(reshape2)\n\n# Create a dataset for plotting\n# First, we need to gather all datasets\nairquality_original <- airquality\nairquality_original$dataset <- \"Original\"\n\nairquality_listwise$dataset <- \"Listwise Deletion\"\nairquality_mean$dataset <- \"Mean Imputation\"\nairquality_regression$dataset <- \"Regression Imputation\"\nairquality_stoch_regression$dataset <- \"Stochastic Regression\"\nairquality_multiple$dataset <- \"Multiple Imputation\"\n\n# Combine all datasets\nall_datasets <- rbind(\n  airquality_original[, c(\"Ozone\", \"dataset\")],\n  airquality_listwise[, c(\"Ozone\", \"dataset\")],\n  airquality_mean[, c(\"Ozone\", \"dataset\")],\n  airquality_regression[, c(\"Ozone\", \"dataset\")],\n  airquality_stoch_regression[, c(\"Ozone\", \"dataset\")],\n  airquality_multiple[, c(\"Ozone\", \"dataset\")]\n)\n\n# Create the density plot\nggplot(all_datasets, aes(x = Ozone, fill = dataset)) +\n  geom_density(alpha = 0.5) +\n  labs(title = \"Density Plot of Ozone: Original vs. Imputed Methods\",\n       x = \"Ozone\", y = \"Density\") +\n  theme_minimal() +\n  scale_fill_brewer(palette = \"Set1\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 37 rows containing non-finite outside the scale range\n(`stat_density()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](Missing_Data_Lab_Questions_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\nWhat do you observe?\n\nAll every other distributions look very similar to the original dataset except for the mean imputation.\n\n#### Of course, each dataset you produced will lead to different modeling results, but we won't go into that in today's lab.\n",
    "supporting": [
      "Missing_Data_Lab_Questions_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}